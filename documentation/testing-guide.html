<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unit Testing Guide</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .container {
            background-color: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        h2 {
            color: #34495e;
            margin-top: 30px;
            border-left: 4px solid #3498db;
            padding-left: 15px;
        }
        h3 {
            color: #555;
            margin-top: 25px;
        }
        code {
            background-color: #f1f2f6;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.9em;
        }
        pre {
            background-color: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 6px;
            overflow-x: auto;
            margin: 15px 0;
        }
        pre code {
            background-color: transparent;
            padding: 0;
            color: inherit;
        }
        .file-tree {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #6c757d;
            font-family: monospace;
            margin: 15px 0;
        }
        .category-box {
            background-color: #e8f5e8;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            border-left: 4px solid #4caf50;
        }
        .alert {
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
            border-left: 4px solid;
        }
        .alert-info {
            background-color: #e3f2fd;
            border-color: #2196f3;
            color: #0277bd;
        }
        .alert-success {
            background-color: #e8f5e8;
            border-color: #4caf50;
            color: #2e7d32;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        tr:nth-child(even) {
            background-color: #f8f9fa;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Unit Testing Guide</h1>

        <h2>Overview</h2>
        <p>The Payment API Testing Framework includes a comprehensive unit test suite using pytest. The test suite covers all components with 81 tests ensuring code quality and reliability.</p>

        <h2>Quick Start</h2>

        <h3>Run All Tests</h3>
        <pre><code># Run complete test suite
pytest

# Run with verbose output
pytest -v

# Run with coverage report
pytest --cov=src</code></pre>

        <h3>Test Structure</h3>
        <div class="file-tree">
tests/
├── conftest.py                    # pytest configuration and fixtures
├── test_data_loader.py           # Data loading functionality tests
├── test_response_utils.py         # Response processing tests
├── test_results_handler.py        # Result formatting and database tests
├── test_utils.py                 # Utility function tests
└── test_request_builders/        # Request builder tests
    ├── test_capture_payment.py
    ├── test_create_payment.py
    ├── test_get_payment.py
    ├── test_get_refund.py
    ├── test_increment_payment.py
    └── test_refund_payment.py
        </div>

        <h2>Running Test Subsets</h2>

        <h3>By Test File</h3>
        <pre><code># Test only data loading
pytest tests/test_data_loader.py

# Test only request builders
pytest tests/test_request_builders/

# Test specific request builder
pytest tests/test_request_builders/test_create_payment.py</code></pre>

        <h3>By Test Class</h3>
        <pre><code># Test specific class in a file
pytest tests/test_results_handler.py::TestCreateSuccessResult

# Test specific class in request builders
pytest tests/test_request_builders/test_create_payment.py::TestBuildCreatePaymentRequest</code></pre>

        <h3>By Test Method</h3>
        <pre><code># Test specific method
pytest tests/test_utils.py::TestGenerateFunctions::test_generate_uuid

# Test specific request builder method
pytest tests/test_request_builders/test_create_payment.py::TestBuildCreatePaymentRequest::test_build_complete_request</code></pre>

        <h3>By Pattern Matching</h3>
        <pre><code># Run tests matching pattern
pytest -k "test_generate"

# Run tests for specific functionality
pytest -k "create_payment"

# Exclude tests matching pattern
pytest -k "not slow"</code></pre>

        <h3>By Markers (if configured)</h3>
        <pre><code># Run only unit tests (if marked)
pytest -m unit

# Run only integration tests (if marked)
pytest -m integration

# Skip slow tests
pytest -m "not slow"</code></pre>

        <h2>Test Categories</h2>

        <div class="category-box">
            <h3>1. Data Loading Tests (test_data_loader.py)</h3>
            <p>Tests CSV configuration file loading:</p>
            <ul>
                <li>File existence validation</li>
                <li>Data type conversion</li>
                <li>Index setting</li>
                <li>Sorting verification</li>
            </ul>
            
            <pre><code># Run all data loading tests
pytest tests/test_data_loader.py -v</code></pre>

            <p><strong>Key Test Methods:</strong></p>
            <ul>
                <li><code>test_load_data_success</code> - Successful data loading</li>
                <li><code>test_load_data_file_not_found</code> - Missing file handling</li>
                <li><code>test_load_data_sorting</code> - Test order verification</li>
            </ul>
        </div>

        <div class="category-box">
            <h3>2. Request Builder Tests (test_request_builders/)</h3>
            <p>Tests API request object construction:</p>
            <ul>
                <li>Required field validation</li>
                <li>Optional field handling</li>
                <li>Data type conversion</li>
                <li>Request cleaning</li>
            </ul>

            <pre><code># Test all request builders
pytest tests/test_request_builders/ -v

# Test only create payment requests
pytest tests/test_request_builders/test_create_payment.py -v</code></pre>

            <p><strong>Test Coverage per Builder:</strong></p>
            <ul>
                <li><strong>Create Payment</strong>: Complete request building, card data, optional fields</li>
                <li><strong>Increment Payment</strong>: Amount handling, operation ID generation</li>
                <li><strong>Capture Payment</strong>: Amount validation, timestamp generation</li>
                <li><strong>Refund Payment</strong>: Optional amount handling, request cleaning</li>
                <li><strong>Get Payment/Refund</strong>: Validation for GET requests (no request body)</li>
            </ul>
        </div>

        <div class="category-box">
            <h3>3. Response Processing Tests (test_response_utils.py)</h3>
            <p>Tests API response handling:</p>
            <ul>
                <li>Transaction ID extraction</li>
                <li>Status code processing</li>
                <li>Previous output updates</li>
                <li>Card description retrieval</li>
            </ul>

            <pre><code># Test response utilities
pytest tests/test_response_utils.py -v</code></pre>

            <p><strong>Key Test Areas:</strong></p>
            <ul>
                <li><code>TestGetTransactionId</code> - ID extraction from different response types</li>
                <li><code>TestGetResponseStatus</code> - Status field extraction</li>
                <li><code>TestUpdatePreviousOutputs</code> - Chain dependency management</li>
                <li><code>TestGetCardDescription</code> - Card information retrieval</li>
            </ul>
        </div>

        <div class="category-box">
            <h3>4. Results Handling Tests (test_results_handler.py)</h3>
            <p>Tests result formatting and database operations:</p>
            <ul>
                <li>Success result creation</li>
                <li>Error result creation</li>
                <li>Error response parsing</li>
                <li>Database operations</li>
            </ul>

            <pre><code># Test results handling
pytest tests/test_results_handler.py -v</code></pre>

            <p><strong>Test Classes:</strong></p>
            <ul>
                <li><code>TestCreateSuccessResult</code> - Successful API call result formatting</li>
                <li><code>TestCreateErrorResult</code> - Failed API call result formatting</li>
                <li><code>TestParseErrorResponse</code> - Error message parsing</li>
                <li><code>TestSaveResults</code> - Database and CSV operations</li>
            </ul>
        </div>

        <div class="category-box">
            <h3>5. Utility Tests (test_utils.py)</h3>
            <p>Tests utility functions:</p>
            <ul>
                <li>Random string generation</li>
                <li>UUID generation</li>
                <li>Configuration file creation</li>
                <li>Request cleaning</li>
            </ul>

            <pre><code># Test utilities
pytest tests/test_utils.py -v</code></pre>

            <p><strong>Key Utilities Tested:</strong></p>
            <ul>
                <li><code>generate_nonce()</code> - Random number generation</li>
                <li><code>generate_random_string()</code> - String generation with validation</li>
                <li><code>generate_uuid()</code> - UUID format validation</li>
                <li><code>create_temp_config()</code> - SDK configuration file creation</li>
                <li><code>clean_request()</code> - Request object cleaning</li>
            </ul>
        </div>

        <h2>Advanced Testing Options</h2>

        <h3>Coverage Reporting</h3>
        <pre><code># Generate coverage report
pytest --cov=src --cov-report=html

# Coverage with missing lines
pytest --cov=src --cov-report=term-missing

# Coverage for specific module
pytest --cov=src.request_builders tests/test_request_builders/</code></pre>

        <h3>Parallel Test Execution</h3>
        <pre><code># Run tests in parallel (requires pytest-xdist)
pytest -n auto

# Run with specific number of workers
pytest -n 4</code></pre>

        <h3>Output Control</h3>
        <pre><code># Capture output (default)
pytest

# Don't capture output (see print statements)
pytest -s

# Show local variables in tracebacks
pytest -l

# Stop on first failure
pytest -x

# Stop after N failures
pytest --maxfail=3</code></pre>

        <h3>Debugging Tests</h3>
        <pre><code># Drop into debugger on failures
pytest --pdb

# Drop into debugger immediately
pytest --pdb-trace

# Trace pytest execution
pytest --trace</code></pre>

        <h2>Test Fixtures</h2>
        <p>The test suite uses several fixtures defined in <code>conftest.py</code>:</p>

        <h3>Mock Fixtures</h3>
        <ul>
            <li><code>mock_cards_df</code> - Sample card data DataFrame</li>
            <li><code>mock_environments_df</code> - Sample environment configurations</li>
            <li><code>mock_merchants_df</code> - Sample merchant data</li>
        </ul>

        <h3>Data Fixtures</h3>
        <ul>
            <li>Sample test data for various scenarios</li>
            <li>Mock API response objects</li>
            <li>Configuration file mockups</li>
        </ul>

        <h2>Writing New Tests</h2>

        <h3>Test Naming Convention</h3>
        <pre><code># Test classes
class TestYourFeature:
    pass

# Test methods
def test_your_specific_case(self):
    pass

# Test files
test_your_module.py</code></pre>

        <h3>Example Test Structure</h3>
        <pre><code>import pytest
from unittest.mock import Mock, patch
from src.your_module import your_function

class TestYourFunction:
    def test_successful_case(self):
        """Test the happy path"""
        result = your_function(valid_input)
        assert result == expected_output
    
    def test_error_case(self):
        """Test error handling"""
        with pytest.raises(ValueError):
            your_function(invalid_input)
    
    @patch('src.your_module.external_dependency')
    def test_with_mock(self, mock_dependency):
        """Test with mocked dependencies"""
        mock_dependency.return_value = mock_value
        result = your_function(input_data)
        assert result == expected_result
        mock_dependency.assert_called_once_with(expected_args)</code></pre>

        <h2>Continuous Integration</h2>
        <p>The test suite is designed to run in CI environments:</p>
        <pre><code># CI-friendly test run
pytest --tb=short --junit-xml=test-results.xml

# With coverage for CI
pytest --cov=src --cov-report=xml --cov-report=term</code></pre>

        <div class="alert alert-success">
            <strong>Test Suite Status:</strong> All 81 tests are currently passing, ensuring the framework's reliability and code quality.
        </div>
    </div>
</body>
</html>